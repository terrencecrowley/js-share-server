{"version":3,"sources":["webpack:///webpack/bootstrap 1e5ad34783a0bc54b999","webpack:///./src/server.ts","webpack:///external \"express\"","webpack:///external \"body-parser\"","webpack:///external \"cookie-parser\"","webpack:///external \"express-session\"","webpack:///external \"passport\"","webpack:///external \"passport-facebook\"","webpack:///external \"passport-local\"","webpack:///external \"connect-flash\"","webpack:///./src/serversession.ts","webpack:///external \"@terrencecrowley/ot-js\"","webpack:///external \"fs\"","webpack:///./src/users.ts","webpack:///external \"bcryptjs\"","webpack:///./src/util.ts"],"names":[],"mappings":"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","file":"shareserver.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 1e5ad34783a0bc54b999","import * as express from \"express\";\nimport * as bodyParser from \"body-parser\";\nimport * as cookieParser from \"cookie-parser\";\nimport * as session from \"express-session\";\nimport * as passport from \"passport\";\nimport * as passport_facebook from \"passport-facebook\";\nimport * as passport_local from \"passport-local\";\nimport flash = require(\"connect-flash\");\nimport * as UM from \"./users\";\n\nlet app = express();\n\nimport * as OTManager from './serversession';\n\nlet serverContext: OTManager.ServerContext = new OTManager.ServerContext();\nvar sessionManager: OTManager.SessionManager = new OTManager.SessionManager(serverContext);\n \napp.use(bodyParser.urlencoded({ extended: true }));\napp.use(bodyParser.json());\napp.use(cookieParser());\napp.use(flash());\napp.use(session({secret: 'OT server', saveUninitialized: true, resave: true, cookie: { maxAge: 1000 * 60 * 60 * 48 } }));\napp.use(passport.initialize());\napp.use(passport.session());\n\n// Setup PORT\nlet port = process.env.PORT || 3000;\n\n// Setup Authentication\nlet clientID = process.env.FACEBOOK_APP_ID || \"\";\nlet clientSecret = process.env.FACEBOOK_APP_SECRET || \"\";\nlet clientCallbackURL = process.env.FACEBOOK_CALLBACK_URL || \"http://localhost:3000/auth/facebook/callback\";\n\n// Routes\nlet router = express.Router();\nlet joinRouter = express.Router();\n\n// Middleware\nrouter.use(function(req, res, next) {\n\tserverContext.log(1, \"Request\");\n\tnext();\n});\njoinRouter.use(function(req, res, next) {\n\tserverContext.log(1, \"Join Request\");\n\tnext();\n});\n\n// HTML routes\napp.use('/', express.static('public'));\napp.use('/scripts', express.static('clientdist'));\n\n// Authentication and user management\nlet FacebookStrategy = passport_facebook.Strategy;\nlet LocalStrategy = passport_local.Strategy;\n\npassport.serializeUser(function(user: UM.User, done: any) {\n\tdone(null, user.serializedID());\n\t});\n\npassport.deserializeUser(function(sid: any, done: any) {\n\tlet user: UM.User = sessionManager.users.findBySerializedID(sid);\n\tdone(null, user);\n\t});\n\npassport.use(new FacebookStrategy(\n\t\t{\n\t\t\tclientID: clientID,\n\t\t\tclientSecret: clientSecret,\n\t\t\tcallbackURL: clientCallbackURL,\n\t\t\tprofileFields: ['emails', 'displayName', 'name']\n\t\t},\n\n\t\tfunction(token, refreshToken, profile, done) {\n\n\t\t\tprocess.nextTick(function() {\n\t\t\t\tlet user: UM.User = sessionManager.users.findByID('facebook', profile.id);\n\t\t\t\tif (user)\n\t\t\t\t\treturn done(null, user);\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tlet o: any = { ns: 'facebook', id: profile.id, token: token };\n\t\t\t\t\tif (profile.name)\n\t\t\t\t\t\to.name = profile.name.givenName + ' ' + profile.name.familyName;\n\t\t\t\t\telse\n\t\t\t\t\t\to.name = 'anon';\n\t\t\t\t\tif (profile.emails)\n\t\t\t\t\t\to.email = profile.emails[0].value;\n\t\t\t\t\telse\n\t\t\t\t\t\to.email = 'someone@anywhere.com';\n\t\t\t\t\tuser = sessionManager.users.createUser(o);\n\t\t\t\t\tdone(null, user);\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t);\n\npassport.use(new LocalStrategy(\n\tfunction(username: any, password: any, done: any) {\n\t\t\tlet user: UM.User = sessionManager.users.findByID('local', username);\n\n\t\t\tif (user == null)\n\t\t\t\treturn done(null, false, { message: 'No such user.' });\n\t\t\telse if (! user.validPassword(password))\n\t\t\t\treturn done(null, false, { message: 'Incorrect password.' });\n\n\t\t\treturn done(null, user);\n\t\t}));\n\n// Middleware to protect API calls with authentication status\nfunction isLoggedIn(req: any, res: any, next: any) {\n\tif (req.user)\n\t\treturn next();\n\treq.session.redirect_to = req.originalUrl;\n\tres.redirect('/login');\n}\n\nfunction isLoggedInAPI(req: any, res: any, next: any) {\n\tif (req.user)\n\t\treturn next();\n\tres.sendStatus(401); // Unauthorized\n}\n  \n// Authenticated pages\napp.use('/pages', isLoggedIn, express.static('pages'));\n\n// Unauthenticated\napp.use('/unauth', express.static('pages'));\n\n// Authentication routes\napp.get('/', function(req: any, res: any) {\n\tif (req.user)\n\t\tres.redirect('/pages/index.html');\n\telse\n\t\tres.redirect('/login');\n});\n\napp.get('/auth/facebook', passport.authenticate('facebook', { scope: 'email' }));\n\napp.get('/auth/facebook/callback',\n\tpassport.authenticate('facebook', { successRedirect: '/login', failureRedirect: '/' }));\n\napp.get('/auth/local', passport.authenticate('local', { successRedirect: '/login', failureRedirect: '/', failureFlash: true } ));\n\napp.get('/signup', function(req: any, res: any) {\n\tres.redirect('/pages/signup.html');\n\t});\n\napp.get('/login', function(req: any, res: any) {\n\t\tif (req.user)\n\t\t{\n\t\t\tif (req.session.redirect_to)\n\t\t\t{\n\t\t\t\tlet url: string = req.session.redirect_to;\n\t\t\t\tdelete req.session.redirect_to;\n\t\t\t\tres.redirect(url);\n\t\t\t}\n\t\t\telse\n\t\t\t\tres.redirect('/pages/index.html');\n\t\t}\n\t\telse\n\t\t\tres.redirect('/unauth/login.html');\n\t});\n\napp.post('/login', function(req: any, res: any) {\n\tif (req.body.signup)\n\t{\n\t\tif (sessionManager.users.findByID('local', req.body.username))\n\t\t{\n\t\t\tres.redirect('/unauth/login.html');\n\t\t\treturn;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet o: any = { ns: 'local', id: req.body.username, password: req.body.password, name: req.body.username };\n\t\t\tlet user: any = sessionManager.users.createUser(o);\n\t\t}\n\t}\n\tpassport.authenticate('local', { successRedirect: '/',\n\t\t\t\t\t\t\t\t\t failureRedirect: '/login',\n\t\t\t\t\t\t\t\t\t failureFlash: true })(req, res, undefined);\n\t});\n\napp.get('/logout', function(req: any, res: any) {\n\treq.logout();\n\tres.redirect('/');\n\t});\n\n// API routes\nrouter.route('/sessions')\n\n\t// Respond with list of sessions\n\t.get(isLoggedInAPI, function(req, res) {\n\t\tserverContext.log(1, \"listSessions\");\n\t\tsessionManager.listSessions(req, res);\n\t\t});\n\nrouter.route('/sessions/userview')\n\t.post(isLoggedInAPI, function(req, res) {\n\t\tserverContext.log(1, \"userview\");\n\t\tsessionManager.userView(req, res);\n\t\t});\n\nrouter.route('/sessions/create')\n\t.post(isLoggedInAPI, function(req, res) {\n\t\tserverContext.log(1, \"createSession\");\n\t\tsessionManager.createSession(req, res);\n\t\t});\n\nrouter.route('/sessions/connect/:session_id')\n\t.post(isLoggedInAPI, function(req, res) {\n\t\tserverContext.log(1, \"connectSession\");\n\t\tsessionManager.connectSession(req, res, req.params.session_id);\n\t\t});\n\nrouter.route('/sessions/sendevent/:session_id')\n\t.post(isLoggedInAPI, function(req, res) {\n\t\tserverContext.log(1, \"sendEvent\");\n\t\tserverContext.log(1, JSON.stringify(req.body));\n\t\tsessionManager.sendEvent(req, res, req.params.session_id, req.body);\n\t\t});\n\nrouter.route('/sessions/receiveevent/:session_id')\n   \t.post(isLoggedInAPI, function(req, res) {\n\t\tserverContext.log(1, \"receiveEvent\");\n\t\tserverContext.log(1, JSON.stringify(req.body));\n\t\tsessionManager.receiveEvent(req, res, req.params.session_id, req.body);\n\t\t});;\n   \n// Api routes\napp.use('/api', router);\n\n// Join existing session\njoinRouter.route('/:session_id')\n\t.get(isLoggedIn, function(req, res) {\n\t\tlet options: any = { root: './' };\n\t\tres.sendFile('pages/index.html', options);\n\t\t});\napp.use('/join', joinRouter);\n\napp.listen(port);\nserverContext.log(0, \"Listening on port \" + port);\n\n\n\n// WEBPACK FOOTER //\n// ./src/server.ts","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"cookie-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cookie-parser\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"express-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-session\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"passport\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"passport-facebook\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport-facebook\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"passport-local\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport-local\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"connect-flash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"connect-flash\"\n// module id = 8\n// module chunks = 0","import * as OT from '@terrencecrowley/ot-js';\nimport * as fs from 'fs';\nimport * as UM from \"./users\";\nimport * as Util from \"./util\";\n\nconst StateVersion: number = 6.0;\nconst ClientIDForServer: string = '-Server-';\n\nconst clientQuiescentTimeout: number = process.env.CLIENT_QUIESCENT_TIMEOUT || 20000; // 20 seconds\nconst sessionQuiescentTimeout: number = process.env.SESSION_QUIESCENT_TIMEOUT || 6000000; // 100 minutes\nconst clientMaxCount: number = process.env.CLIENT_MAX_COUNT || 50;\nconst maxEditLogSize: number = process.env.MAX_EDIT_LOG_SIZE || 500;\n\nexport class ServerContext implements OT.IExecutionContext\n{\n\tverbosity: number;\n\n\tconstructor()\n\t\t{\n\t\t\tthis.verbosity = process.env.VERBOSITY || 0;\n\t\t}\n\n\tflagIsSet(flag: string): boolean\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\tflagValue(flag: string): number\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\tlog(verbose: number, s: string): void\n\t\t{\n\t\t\tif (verbose <= this.verbosity)\n\t\t\t\tconsole.log(s);\t\n\t\t}\n}\n\nexport class Client\n{\n\tclientID: string;\n\tuser: UM.User;\n\tprivate context: ServerContext;\n\tprivate lastActive: Date;\n\tprivate longPollResponse: any;\n\tprivate longPollResponseBody: any;\n\n\t// constructor\n\tconstructor(ctx: ServerContext, sid: string, cid: string, u: any)\n\t\t{\n\t\t\tthis.user = u as UM.User;\n\t\t\tthis.user.sessions[sid] = true;\n\t\t\tthis.clientID = cid;\n\t\t\tthis.context = ctx;\n\t\t\tthis.lastActive = new Date();\n\t\t\tthis.longPollResponse = null;\n\t\t\tthis.longPollResponseBody = null;\n\t\t}\n\n\t\n\tisZombie(fromDate?: Date, timeout?: number): boolean\n\t\t{\n\t\t\tif (fromDate === undefined) fromDate = new Date();\n\t\t\tif (timeout === undefined) timeout = clientQuiescentTimeout;\n\n\t\t\treturn ((fromDate.getTime() - this.lastActive.getTime()) > timeout);\n\t\t}\n\n\tmarkAlive(): Client\n\t\t{\n\t\t\tthis.lastActive = new Date();\n\t\t\treturn this;\n\t\t}\n\n\tparkResponse(res: any, body: any): void\n\t\t{\n\t\t\tthis.longPollResponse = res;\n\t\t\tthis.longPollResponseBody = body;\n\t\t}\n\n\tunparkResponse(): void\n\t\t{\n\t\t\tif (this.longPollResponse)\n\t\t\t{\n\t\t\t\tthis.context.log(2, \"unparkResponse for client: \" + String(this.clientID));\n\t\t\t\tthis.longPollResponse.json(this.longPollResponseBody);\n\t\t\t\tthis.longPollResponse = null;\n\t\t\t\tthis.longPollResponseBody = null;\n\t\t\t}\n\t\t}\n}\n\nexport class Session\n{\n\tsessionID: string;\n\tserverEngine: OT.OTServerEngine;\n\tclients: Client[];\n\tprivate context: ServerContext;\n\tprivate lastActive: Date;\n\tprivate clientSequenceNo: number;\n\t// stats\n\tprivate statMaxClients: number;\n\tprivate statRequestCount: number;\n\n\t// Constructor\n\tconstructor(ctx: ServerContext)\n\t\t{\n\t\t\tthis.context = ctx;\n\t\t\tthis.sessionID = Util.createGuid();\n\t\t\tthis.serverEngine = new OT.OTServerEngine(ctx, this.sessionID);\n\t\t\tthis.clients = [];\n\t\t\tthis.lastActive = new Date();\n\t\t\tthis.clientSequenceNo = 0;\n\t\t\tthis.statMaxClients = 0;\n\t\t\tthis.statRequestCount = 0;\n\t\t\tthis.context.log(0, \"session(\" + this.sessionID + \"): created.\");\n\t\t}\n\n\tisZombie(fromDate?: Date, timeout?: number): boolean\n\t\t{\n\t\t\tif (fromDate === undefined) fromDate = new Date();\n\t\t\tif (timeout === undefined) timeout = sessionQuiescentTimeout;\n\t\t\treturn (this.clients.length == 0) && ((fromDate.getTime() - this.lastActive.getTime()) > timeout);\n\t\t}\n\n\tunparkClients(): void\n\t\t{\n\t\t\tfor (let i: number = 0; i < this.clients.length; i++)\n\t\t\t\tthis.clients[i].unparkResponse();\n\t\t}\n\n\tgetUserList(): any\n\t\t{\n\t\t\tlet val: any = this.serverEngine.toValue();\n\t\t\tval = val ? val['WellKnownName_users'] : val;\n\t\t\tif (val == null) val = { };\n\t\t\treturn val;\n\t\t}\n\n\tgetUserName(client: Client): any\n\t\t{\n\t\t\tlet val: any = this.getUserList();\n\t\t\treturn val[client.clientID];\n\t\t}\n\n\tupdateUserList(): void\n\t\t{\n\t\t\tlet now: Date = new Date();\n\t\t\tlet val: any = this.getUserList();\n\t\t\tlet cedit: OT.OTCompositeResource = new OT.OTCompositeResource(this.sessionID, ClientIDForServer);\n\t\t\tlet medit: OT.OTMapResource = new OT.OTMapResource('WellKnownName_users');\n\t\t\tcedit.edits.push(medit);\n\t\t\tcedit.clock = this.serverEngine.serverClock();\n\t\t\tfor (let i: number = this.clients.length-1; i >= 0; i--) // backwards since may be deleting\n\t\t\t{\n\t\t\t\tlet c: Client = this.clients[i];\n\t\t\t\tif (c.isZombie(now))\n\t\t\t\t{\n\t\t\t\t\tif (val[c.clientID] !== undefined)\n\t\t\t\t\t\tmedit.edits.push([ OT.OpMapDel, c.clientID, '' ]);\n\t\t\t\t\tthis.context.log(0, \"session(\" + this.sessionID + \"): removing zombie client(\" + c.clientID + \")\");\n\t\t\t\t\tthis.clients.splice(i, 1);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tif (val[c.clientID] === undefined)\n\t\t\t\t\t\tmedit.edits.push([ OT.OpMapSet, c.clientID, c.user.name ]);\n\t\t\t}\n\t\t\tif (! medit.isEmpty())\n\t\t\t{\n\t\t\t\tcedit.clientSequenceNo = this.clientSequenceNo++;\n\t\t\t\tthis.serverEngine.addServer(cedit);\n\t\t\t}\n\t\t}\n\n\tcompress(): void\n\t\t{\n\t\t\t// Would probably make more sense to make how we compress dynamic based on how clients are behaving.\n\t\t\t// Also, a better approach would be to just keep composed variants along size the main array and\n\t\t\t// then more slowly age out the finer grained log entries. But just do this for now so the log\n\t\t\t// doesn't grow without bound.\n\t\t\tif (this.serverEngine.logServer.length > maxEditLogSize)\n\t\t\t{\n\t\t\t\t// Just compress first 20%\n\t\t\t\tlet nCompress: number = Math.floor(maxEditLogSize / 5);\n\t\t\t\tlet cedit: OT.OTCompositeResource = this.serverEngine.logServer[0];\n\t\t\t\tfor (let i: number = 1; i < nCompress; i++)\n\t\t\t\t\tcedit.compose(this.serverEngine.logServer[i]);\n\t\t\t\tthis.serverEngine.logServer.splice(1, nCompress-1);\n\t\t\t\tthis.context.log(0, \"session(\" + this.sessionID + \"): compressing log.\");\n\t\t\t}\n\t\t}\n\n\t// Connect\n\tconnectSession(req: any, res: any): void\n\t\t{\n\t\t\tthis.lastActive = new Date();\n\t\t\tthis.statRequestCount++;\n\t\t\tlet responseBody: any;\n\t\t\tif (this.clients.length >= clientMaxCount)\n\t\t\t{\n\t\t\t\tresponseBody = { \"result\": 2, \"message\": 'Too many clients.' };\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet clientID: any = req.body.clientID ? req.body.clientID : Util.createGuid();\n\t\t\t\tlet client: Client = this.findClient(clientID, req.user).markAlive();\n\t\t\t\tthis.context.log(0, \"session(\" + this.sessionID + \"): creating client(\" + client.clientID + \")\");\n\t\t\t\tresponseBody = { result: 0, clientID: client.clientID, view: this.toView() };\n\t\t\t}\n\t\t\tthis.context.log(1, \"connectSession: \" + JSON.stringify(responseBody));\n\t\t\tres.json(responseBody);\n\t\t\tthis.updateUserList();\n\t\t}\n\n\tprivate nakedEditList(nextclock: number): any\n\t\t{\n\t\t\tlet a: OT.OTCompositeResource[];\n\t\t\tif (nextclock === 0)\n\t\t\t\ta = this.serverEngine.logServer;\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet nLog: number = this.serverEngine.logServer.length;\n\t\t\t\tlet i: number;\n\t\t\t\tif (nLog == 0)\n\t\t\t\t\treturn [];\n\t\t\t\tfor (i = nLog-1; i >= 0; i--)\n\t\t\t\t\tif (this.serverEngine.logServer[i].clock == nextclock)\n\t\t\t\t\t\tbreak;\n\t\t\t\t\telse if (this.serverEngine.logServer[i].clock < nextclock)\n\t\t\t\t\t{\n\t\t\t\t\t\t// FIX: really should fail this request if I requested a nextclock that was compressed out.\n\t\t\t\t\t\t// Really the only valid case this clause is catching is the end of the array case.\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tif (i === -1)\n\t\t\t\t\treturn [];\n\t\t\t\ta = this.serverEngine.logServer.slice(i);\n\t\t\t}\n\t\t\tlet retA: any[] = [];\n\t\t\tfor (let i: number = 0; i < a.length; i++)\n\t\t\t\tretA.push(a[i].toJSON());\n\t\t\treturn retA;\n\t\t}\n\n\t// Client Event\n\t\t// IN: { clientID: id, Edit: OT.OTCompositeResource }\n\t\t// OUT: { result: 0, EditList:[ OT.OTCompositeResource ] }\n\tsendEvent(req: any, res: any, body: any): void\n\t\t{\n\t\t\tthis.lastActive = new Date();\n\t\t\tthis.statRequestCount++;\n\t\t\tthis.unparkClients();\n\t\t\tlet edit: OT.OTCompositeResource = OT.OTCompositeResource.constructFromObject(body[\"Edit\"]);\n\t\t\tlet client: Client = this.findClient(body[\"clientID\"], req.user).markAlive();\n\t\t\tlet responseBody: any = null;\n\t\t\tlet nResult: number = this.serverEngine.addServer(edit);\n\t\t\tif (nResult === OT.clockSuccess)\n\t\t\t{\n\t\t\t\t// Drain any unsent actions (including this one)\n\t\t\t\tresponseBody = { result: 0,\n\t\t\t\t\t\t\t\t clientID: client.clientID,\n\t\t\t\t\t\t\t\t view: this.toView(),\n\t\t\t\t\t\t\t\t EditList: this.nakedEditList(edit.clock + 1)\n\t\t\t\t\t\t\t\t };\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// Clock unavailable\n\t\t\t\tresponseBody = { result: nResult, \"message\": \"sendEvent: failure: \" + nResult };\n\t\t\t}\n\t\t\tthis.context.log(1, \"sendEvent: \" + JSON.stringify(responseBody));\n\t\t\tres.json(responseBody);\n\t\t}\n\n\t// Receive Event\n\t\t// IN: { clientID: id, NextClock: number }\n\t\t// OUT: { \"result\": 0, \"EditList\": [ OT.OTCompositeResource ] }\n\treceiveEvent(req: any, res: any, body: any): void\n\t\t{\n\t\t\tthis.lastActive = new Date();\n\t\t\tthis.statRequestCount++;\n\t\t\tlet client: Client = this.findClient(body[\"clientID\"], req.user).markAlive();\n\t\t\tlet nextClock: number = Number(body[\"NextClock\"]);\n\t\t\tlet responseBody: any = null;\n\t\t\tif (nextClock === NaN)\n\t\t\t{\n\t\t\t\tresponseBody = { result: 1, \"message\": \"receiveEvent: invalid clock: \" + body[\"NextClock\"] };\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// Send any unsent edits\n\t\t\t\tresponseBody = { result: 0,\n\t\t\t\t\t\t\t     clientID: client.clientID,\n\t\t\t\t\t\t\t\t view: this.toView(),\n\t\t\t\t\t\t\t\t EditList: this.nakedEditList(nextClock) };\n\t\t\t\tif (responseBody.EditList.length == 0)\n\t\t\t\t{\n\t\t\t\t\tclient.parkResponse(res, responseBody);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.context.log(1, \"receiveEvent: \" + JSON.stringify(responseBody));\n\t\t\tres.json(responseBody);\n\t\t}\n\n\tlogStats(): void\n\t\t{\n\t\t\tthis.context.log(0, \"session(\" + this.sessionID + \"): terminating.\");\n\t\t\tthis.context.log(0, \"session(\" + this.sessionID + \"): MaxClients(\" + String(this.statMaxClients) + \")\");\n\t\t\tthis.context.log(0, \"session(\" + this.sessionID + \"): Requests(\" + String(this.statRequestCount) + \")\");\n\t\t}\n\n\t// Helpers\n\tfindClient(cid: string, user: any): Client\n\t\t{\n\t\t\tfor (let i: number = 0; i < this.clients.length; i++)\n\t\t\t{\n\t\t\t\tlet c: Client = this.clients[i];\n\n\t\t\t\tif (c.clientID === cid)\n\t\t\t\t\treturn c;\n\t\t\t}\n\n\t\t\t// Create on the fly - may be creating new or recreating a zombie client we've edited out\n\t\t\tthis.context.log(0, \"session(\" + this.sessionID + \"): constructing client(\" + cid + \")\");\n\t\t\tlet c: Client = new Client(this.context, this.sessionID, cid, user);\n\t\t\tthis.clients.push(c);\n\t\t\tif (this.clients.length > this.statMaxClients) this.statMaxClients = this.clients.length;\n\t\t\treturn c;\n\t\t}\n\n\ttoView(): any\n\t\t{\n\t\t\tlet o: any =\n\t\t\t\t{\n\t\t\t\t\tsessionID: this.sessionID,\n\t\t\t\t\tsessionName: this.serverEngine.getName(),\n\t\t\t\t\tsessionType: this.serverEngine.getType(),\n\t\t\t\t\tlastActive: this.lastActive.toJSON(),\n\t\t\t\t\tclientCount: this.clients.length,\n\t\t\t\t\tmaxClients: this.statMaxClients,\n\t\t\t\t\trequestCount: this.statRequestCount\n\t\t\t\t};\n\t\t\treturn o;\n\t\t}\n\n\ttoJSON(): any\n\t\t{\n\t\t\treturn { \n\t\t\t\tsessionID: this.sessionID,\n\t\t\t\tlastActive: this.lastActive.toJSON(),\n\t\t\t\tmaxClients: this.statMaxClients,\n\t\t\t\tengine: this.serverEngine.toJSON()\n\t\t\t\t};\n\t\t}\n\n\tfromJSON(o: any): void\n\t\t{\n\t\t\tthis.sessionID = o.sessionID;\n\t\t\tthis.lastActive = new Date(o.lastActive);\n\t\t\tthis.statMaxClients = o.statMaxClients;\n\t\t\tthis.serverEngine.loadFromObject(o.engine);\n\t\t}\n}\n\nexport class SessionManager\n{\n\tprivate _users: UM.Users;\n\tprivate context: ServerContext;\n\tprivate sessions: Session[];\n\tprivate sessionMap: any;\n\tprivate bTimerSet: boolean;\n\tprivate bDirty: boolean;\n\tprivate bSaving: boolean;\n\tprivate nHouseKeeping: number;\n\n\t// constructor\n\tconstructor(ctx: ServerContext)\n\t\t{\n\t\t\tthis.context = ctx;\n\t\t\tthis.sessions = [];\n\t\t\tthis.sessionMap = {};\n\t\t\tthis.bTimerSet = false;\n\t\t\tthis.bSaving = false;\n\t\t\tthis.nHouseKeeping = 0;\n\t\t\tthis.setHousekeepingTimer();\n\t\t\tthis.load();\n\t\t\tthis._users = new UM.Users(ctx);\n\t\t\tthis._users.load();\n\t\t}\n\n\t// User management\n\tget users(): UM.Users\n\t\t{\n\t\t\treturn this._users;\n\t\t}\n\n\t// List Session\n\t\t// OUT: { \"result\": 0, \"sessions\": [ { \"session_id\": string}* ] }\n\tlistSessions(req: any, res: any): void\n\t\t{\n\t\t\tlet responseBody: any = { \"result\": 0 };\n\t\t\tlet aSession: Array<any> = [];\n\t\t\tfor (let i = 0; i < this.sessions.length; i++)\n\t\t\t\taSession.push({ \"session_id\": this.sessions[i].sessionID });\n\t\t\tresponseBody[\"sessions\"] = aSession;\n\t\t\tthis.context.log(1, \"listSessions: \" + JSON.stringify(responseBody));\n\t\t\tres.json(responseBody);\n\t\t\tthis.setHousekeepingTimer();\n\t\t}\n\n\t// User View\n\t\t// OUT: { result: 0, user: { user info } }\n\tuserView(req: any, res: any): void\n\t\t{\n\t\t\tlet responseBody: any = { result: 0 };\n\t\t\tif (req.user == null)\n\t\t\t{\n\t\t\t\tresponseBody.result = 1;\n\t\t\t\tresponseBody.message = \"No valid user.\";\n\t\t\t}\n\t\t\telse\n\t\t\t\tresponseBody.user = req.user.toView(this);\n\t\t\tres.json(responseBody);\n\t\t\tthis.setHousekeepingTimer();\n\t\t}\n\n\t// Create\n\t\t// IN: {  }\n\t\t// OUT: { result: 0, session_id: string }\n\tcreateSession(req: any, res: any): void\n\t\t{\n\t\t\tlet session: Session = new Session(this.context);\n\t\t\tthis.sessions.push(session);\n\t\t\tthis.sessionMap[session.sessionID] = session;\n\t\t\tlet responseBody: any = { result: 0, view: session.toView() };\n\t\t\tthis.context.log(1, \"createSession: \" + JSON.stringify(responseBody));\n\t\t\tres.json(responseBody);\n\t\t\tthis.bDirty = true;\n\t\t\tthis.setHousekeepingTimer();\n\t\t}\n\n\t// Connect\n\t\t// OUT: { result: [0,1], message: \"failure message\", clientID: cid, session: { session_info } }\n\tconnectSession(req: any, res: any, session_id: string): void\n\t\t{\n\t\t\tlet session: Session = this.findSession(session_id);\n\t\t\tif (session)\n\t\t\t{\n\t\t\t\tsession.connectSession(req, res);\n\t\t\t\tthis.bDirty = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet responseBody: any = { \"result\": 1, \"message\": \"connectSession: no such session: \" + session_id };\n\t\t\t\tthis.context.log(1, \"connectSession: \" + JSON.stringify(responseBody));\n\t\t\t\tres.json(responseBody);\n\t\t\t}\n\t\t\tthis.setHousekeepingTimer();\n\t\t}\n\n\t// Send Event\n\t\t// IN: { clientID: id, Edit: OT.OTCompositeResource }\n\t\t// OUT: { result: 0, EditList:[ OT.OTCompositeResource ] }\n\tsendEvent(req: any, res: any, session_id: string, body: any): void\n\t\t{\n\t\t\tlet session: Session = this.findSession(session_id);\n\t\t\tif (session)\n\t\t\t{\n\t\t\t\tsession.sendEvent(req, res, body);\n\t\t\t\tthis.bDirty = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet responseBody: any = { result: 1, \"message\": \"sendEvent: no such session: \" + session_id };\n\t\t\t\tthis.context.log(1, \"sendEvent: \" + JSON.stringify(responseBody));\n\t\t\t\tres.json(responseBody);\n\t\t\t}\n\t\t\tthis.setHousekeepingTimer();\n\t\t}\n\n\t// Receive Event\n\t\t// IN: { clientID: id, NextClock: number }\n\t\t// OUT: { \"result\": 0 \"EditList\": [ OT.OTCompositeResource ] }\n\treceiveEvent(req: any, res: any, session_id: string, body: any): void\n\t\t{\n\t\t\tlet session: Session = this.findSession(session_id);\n\t\t\tif (session)\n\t\t\t\tsession.receiveEvent(req, res, body);\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet responseBody: any = { \"result\": 1, \"message\": \"receiveEvent: no such session: \" + session_id };\n\t\t\t\tthis.context.log(1, \"receiveEvent: \" + JSON.stringify(responseBody));\n\t\t\t\tres.json(responseBody);\n\t\t\t}\n\t\t\tthis.setHousekeepingTimer();\n\t\t}\n\n\t// Helpers\n\tfindSession(session_id: string): Session\n\t\t{\n\t\t\tlet session: Session = this.sessionMap[session_id];\n\t\t\treturn session ? session : null;\n\t\t}\n\n\t// housekeeping Timer\n\thousekeepingOnTimer(): void\n\t\t{\n\t\t\tthis.nHouseKeeping++;\n\n\t\t\tlet now: Date = new Date();\n\t\t\tthis.bTimerSet = false;\n\n\t\t\t// Get rid of quiescent clients\n\t\t\tfor (let i: number = this.sessions.length-1; i >= 0; i--) // backwards so deleting simplified\n\t\t\t{\n\t\t\t\tlet session: Session = this.sessions[i];\n\n\t\t\t\t// Unpark any parked long-poll clients\n\t\t\t\tsession.unparkClients();\n\n\t\t\t\t// Update user list\n\t\t\t\tsession.updateUserList();\n\n\t\t\t\t// Compress session log\n\t\t\t\tsession.compress();\n\n\t\t\t\t// Delete if necessary\n\t\t\t\tif (session.isZombie(now))\n\t\t\t\t{\n\t\t\t\t\tsession.logStats();\n\t\t\t\t\tthis.sessions.splice(i, 1);\n\t\t\t\t\tdelete this.sessionMap[session.sessionID];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Preserve state for restart every once in a while\n\t\t\tif ((this.nHouseKeeping % 2) == 0)\n\t\t\t\tthis.save();\n\n\t\t\t// Do it again\n\t\t\tthis.setHousekeepingTimer();\n\t\t}\n\n\t// Set timer for housekeeping\n\tsetHousekeepingTimer(): void\n\t\t{\n\t\t\ttheManager = this;\n\n\t\t\tif (!this.bTimerSet && this.sessions.length > 0)\n\t\t\t{\n\t\t\t\tif (this.sessions.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.bTimerSet = true;\n\t\t\t\t\tsetTimeout(function () { theManager.housekeepingOnTimer(); }, 5000);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tthis.save();\n\t\t\t}\n\t\t}\n\n\ttoJSON(): any\n\t\t{\n\t\t\tlet o: any = { version: StateVersion, sessions: { } };\n\t\t\tlet oSessions: any = o.sessions;\n\n\t\t\tfor (let i: number = 0; i < this.sessions.length; i++)\n\t\t\t{\n\t\t\t\tlet session: Session = this.sessions[i];\n\n\t\t\t\toSessions[session.sessionID] = session.toJSON();\n\t\t\t}\n\t\t\treturn o;\n\t\t}\n\n\tfromJSON(o: any): void\n\t\t{\n\t\t\t// Ignore unknown versions\n\t\t\tlet version: number = o['version'];\n\t\t\tif (version === undefined || version != StateVersion)\n\t\t\t\treturn;\n\n\t\t\t// Load sessions\n\t\t\to = o['sessions'];\n\t\t\tif (o === undefined)\n\t\t\t\treturn;\n\n\t\t\tfor (var p in o)\n\t\t\t\tif (o.hasOwnProperty(p))\n\t\t\t\t{\n\t\t\t\t\tlet session: Session = new Session(this.context);\n\t\t\t\t\t//session.sessionID = p;\n\t\t\t\t\tsession.fromJSON(o[p]);\n\t\t\t\t\tthis.sessions.push(session);\n\t\t\t\t\tthis.sessionMap[session.sessionID] = session;\n\t\t\t\t}\n\t\t}\n\n\tsave(): void\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.users.save();\n\n\t\t\t\tif (this.bDirty && !this.bSaving)\n\t\t\t\t{\n\t\t\t\t\tlet s: string = JSON.stringify(this);\n\t\t\t\t\tthis.bSaving = true;\n\t\t\t\t\tfs.writeFile('state/state.json', s, (err) => {\n\t\t\t\t\t\t\ttheManager.bSaving = false;\n\t\t\t\t\t\t\ttheManager.bDirty = false;\n\t\t\t\t\t\t\tif (err) throw err;\n\t\t\t\t\t\t});\n\t\t\t\t\tthis.context.log(0, \"SessionManager: state saved\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (err)\n\t\t\t{\n\t\t\t\tthis.context.log(0, \"SessionManager: save state failed: \" + err);\n\t\t\t}\n\t\t}\n\n\tload(): void\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tlet s: string = fs.readFileSync('state/state.json', 'utf8');\n\t\t\t\tlet o: any = JSON.parse(s);\n\t\t\t\tthis.fromJSON(o);\n\t\t\t\tthis.bDirty = false;\n\t\t\t}\n\t\t\tcatch (err)\n\t\t\t{\n\t\t\t\tthis.context.log(0, \"SessionManager: load state failed: \" + err);\n\t\t\t}\n\t\t}\n}\n\nlet theManager: SessionManager;\n\n\n\n// WEBPACK FOOTER //\n// ./src/serversession.ts","module.exports = require(\"@terrencecrowley/ot-js\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@terrencecrowley/ot-js\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 11\n// module chunks = 0","import * as fs from 'fs';\nimport * as OT from '@terrencecrowley/ot-js';\nimport * as SM from './serversession';\nimport * as bcrypt from 'bcryptjs';\n\nconst StateVersion: number = 4.0;\n\nexport class User\n{\n\tns: string;\n\tid: string;\n\ttoken: string;\n\tname: string;\n\temail: string;\n\thash: string;\n\tsessions: any;\n\n\tconstructor(o?: any)\n\t\t{\n\t\t\tif (o != undefined)\n\t\t\t\tthis.fromJSON(o);\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.ns = '';\n\t\t\t\tthis.id = '';\n\t\t\t\tthis.token = '';\n\t\t\t\tthis.name = '';\n\t\t\t\tthis.email = '';\n\t\t\t\tthis.hash = '';\n\t\t\t\tthis.sessions = {};\n\t\t\t}\n\t\t}\n\n\tserializedID(): string\n\t\t{\n\t\t\treturn this.ns + '/' + this.id;\n\t\t}\n\n\tvalidPassword(pw: string): boolean\n\t\t{\n\t\t\treturn bcrypt.compareSync(pw, this.hash);\n\t\t}\n\n\ttoJSON(): any\n\t\t{\n\t\t\tlet o: any = { sid: this.serializedID(), token: this.token, name: this.name, email: this.email, sessions: this.sessions };\n\t\t\tif (this.hash)\n\t\t\t\to.hash = this.hash;\n\t\t\treturn o;\n\t\t}\n\n\tfromJSON(o: any): void\n\t\t{\n\t\t\tthis.ns = o.ns;\n\t\t\tthis.id = o.id;\n\t\t\tthis.token = o.token;\n\t\t\tthis.name = o.name;\n\t\t\tthis.email = o.email;\n\t\t\tif (o.hash)\n\t\t\t\tthis.hash = o.hash;\n\t\t\tif (o.password)\n\t\t\t\tthis.hash = bcrypt.hashSync(o.password, 8);\n\t\t\tthis.sessions = o.sessions;\n\t\t\tif (this.sessions == null)\n\t\t\t\tthis.sessions = {};\n\t\t}\n\n\ttoView(sm: SM.SessionManager): any\n\t\t{\n\t\t\tlet o: any = { ns: this.ns, id: this.id, name: this.name, sessions: [] };\n\t\t\tlet aS: any = o.sessions;\n\t\t\tfor (var p in this.sessions)\n\t\t\t\tif (this.sessions.hasOwnProperty(p))\n\t\t\t\t{\n\t\t\t\t\tlet s: SM.Session = sm.findSession(p);\n\t\t\t\t\tif (s)\n\t\t\t\t\t\taS.push(s.toView());\n\t\t\t\t}\n\n\t\t\treturn o;\n\t\t}\n}\n\nexport class Users\n{\n\tusers: User[];\n\tprivate context: OT.IExecutionContext;\n\tprivate bDirty: boolean;\n\tprivate bSaving: boolean;\n\n\t// Constructor\n\tconstructor(ctx: OT.IExecutionContext)\n\t\t{\n\t\t\tthis.context = ctx;\n\t\t\tthis.users = [];\n\t\t\tthis.bDirty = false;\n\t\t\tthis.bSaving = false;\n\t\t\tUserManager = this;\n\t\t}\n\n\tfindByID(ns: string, id: string): User\n\t\t{\n\t\t\tfor (let i: number = 0; i < this.users.length; i++)\n\t\t\t\tif (this.users[i].ns == ns && this.users[i].id == id)\n\t\t\t\t\treturn this.users[i];\n\t\t\treturn null;\n\t\t}\n\n\tfindBySerializedID(sid: string): User\n\t\t{\n\t\t\tlet i: number = sid.indexOf('/');\n\t\t\tif (i == -1)\n\t\t\t\treturn this.findByID('', sid);\n\t\t\tlet ns: string = sid.substr(0, i);\n\t\t\tlet id: string = sid.substr(i+1);\n\t\t\tfor (let i: number = 0; i < this.users.length; i++)\n\t\t\t\tif (this.users[i].ns == ns && this.users[i].id == id)\n\t\t\t\t\treturn this.users[i];\n\t\t\treturn null;\n\t\t}\n\n\tcreateUser(o: any): User\n\t\t{\n\t\t\tlet u: User = new User(o);\n\t\t\tthis.users.push(u);\n\t\t\tthis.bDirty = true;\n\t\t\treturn u;\n\t\t}\n\n\ttoJSON(): any\n\t\t{\n\t\t\tlet o: any = { version: StateVersion, users: [] };\n\t\t\tlet aUsers: any[] = o.users;\n\t\t\tfor (let i: number = 0; i < this.users.length; i++)\n\t\t\t\taUsers.push(this.users[i].toJSON());\n\t\t\treturn o;\n\t\t}\n\n\tfromJSON(o: any): void\n\t\t{\n\t\t\tif (o.version == StateVersion)\n\t\t\t{\n\t\t\t\tfor (let i: number = 0; i < o.users.length; i++)\n\t\t\t\t\tthis.users.push(new User(o.users[i]));\n\t\t\t}\n\t\t\tthis.bDirty = false;\n\t\t}\n\n\tsave(): void\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tif (this.bDirty && !this.bSaving)\n\t\t\t\t{\n\t\t\t\t\tlet s: string = JSON.stringify(this);\n\t\t\t\t\tthis.bSaving = true;\n\t\t\t\t\tfs.writeFile('state/users.json', s, (err) => {\n\t\t\t\t\t\t\tUserManager.bSaving = false;\n\t\t\t\t\t\t\tUserManager.bDirty = false;\n\t\t\t\t\t\t\tif (err) throw err;\n\t\t\t\t\t\t});\n\t\t\t\t\tthis.context.log(0, \"UserManager: state saved\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (err)\n\t\t\t{\n\t\t\t\tthis.context.log(0, \"UserManager: save state failed: \" + err);\n\t\t\t}\n\t\t}\n\n\tload(): void\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tlet s: string = fs.readFileSync('state/users.json', 'utf8');\n\t\t\t\tlet o: any = JSON.parse(s);\n\t\t\t\tif (o.version == StateVersion)\n\t\t\t\t\tthis.fromJSON(o);\n\t\t\t\tthis.bDirty = false;\n\t\t\t}\n\t\t\tcatch (err)\n\t\t\t{\n\t\t\t\tthis.context.log(0, \"UserManager: load state failed: \" + err);\n\t\t\t}\n\t\t}\n}\n\nlet UserManager: Users;\n\n\n\n// WEBPACK FOOTER //\n// ./src/users.ts","module.exports = require(\"bcryptjs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bcryptjs\"\n// module id = 13\n// module chunks = 0","export function createGuid(): string\n{\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n\t\tvar r = Math.random()*16|0, v = c === 'x' ? r : (r&0x3|0x8);\n\t\treturn v.toString(16);\n\t});\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/util.ts"],"sourceRoot":""}